# **README - Aplicație Java pentru Gestionarea Cărților cu Spring Boot**

---

## **Descriere generală**
Această aplicație Java, construită cu Spring Boot, este un sistem simplu de gestionare a cărților care implementează operații CRUD (Create, Read, Update, Delete). Aplicația utilizează:

- **Spring Data JPA** pentru maparea obiect-relatională (ORM).
- **H2 Database** ca bază de date încorporată.
- **Flyway** pentru gestionarea migrațiilor bazei de date.
- **Bean Validation** pentru validarea datelor de intrare.

Aplicația include un model suplimentar, `Publisher` (Editură), care este legat de entitatea `Book` (Carte) printr-o relație de tip `ManyToOne`.

---

## **Cerințe preliminare**

### **Software necesar**
- **Java** 11 sau mai recent
- **Maven** 3.6+
- Un IDE, cum ar fi IntelliJ IDEA sau Eclipse

### **Dependențe utilizate**
- Spring Boot Starter Web
- Spring Boot Starter Data JPA
- H2 Database
- Flyway Migration
- Spring Boot Starter Validation

---

## **Configurare**

### **Fișierul `application.properties`**
Aplicația folosește H2 Database și configurează migrațiile Flyway astfel:

```properties
spring.datasource.url=jdbc:h2:mem:booksdb
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=true
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect

spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration

spring.h2.console.enabled=true
spring.h2.console.path=/h2-console
```
## **Structura aplicației**

### **Pachete principale**
- **com.example.demo.model**: Conține entitățile `Book` și `Publisher`.
- **com.example.demo.repository**: Interfețe pentru accesul la date (`BookRepository` și `PublisherRepository`).
- **com.example.demo.service**: Conține logica de business pentru gestionarea cărților (`BookService`) și editurilor (`PublisherService`).
- **com.example.demo.controller**: Expune API-urile REST prin clasele `BookController` și `PublisherController`.

### **Entități**
1. **Book**:
    - `id`: Identificator unic.
    - `title`: Titlul cărții.
    - `author`: Autorul cărții.
    - `publisher`: Relație `ManyToOne` cu entitatea `Publisher`.

2. **Publisher**:
    - `id`: Identificator unic.
    - `name`: Numele editurii.
    - `books`: Relație `OneToMany` cu entitatea `Book`.

---

## **Migrații Flyway**

### **Scripturi de migrare**
1. `V1__Create_book_table.sql`:
   ```sql
   CREATE TABLE book (
       id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
       title VARCHAR(100) NOT NULL,
       author VARCHAR(50) NOT NULL
   );
---

2. `V2__Create_publisher_table.sql`:
   ```sql
   CREATE TABLE publisher (
       id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
       name VARCHAR(100) NOT NULL
   );

   ALTER TABLE book
   ADD COLUMN publisher_id BIGINT;

   ALTER TABLE book
   ADD CONSTRAINT fk_publisher
   FOREIGN KEY (publisher_id)
   REFERENCES publisher(id);
---
3. `V3__Populate_data.sql`:
   ```sql
   INSERT INTO publisher (name) VALUES ('Editura Humanitas');
   INSERT INTO publisher (name) VALUES ('Editura Polirom');
   INSERT INTO publisher (name) VALUES ('Editura RAO');

   INSERT INTO book (title, author, publisher_id) VALUES ('Cartea Soarelui', 'Ion Popescu', 1);
   INSERT INTO book (title, author, publisher_id) VALUES ('Misterele Pădurii', 'Maria Ionescu', 2);
   INSERT INTO book (title, author, publisher_id) VALUES ('Aventurile lui Tom', 'George Enescu', 3);
---

## **Endpoint-uri REST**

### **BookController**
1. **GET** `/api/books`: Obține toate cărțile.
2. **GET** `/api/books/{id}`: Obține o carte după ID.
3. **POST** `/api/books?publisherId={publisherId}`:
    - Creați o carte asociată unei edituri.
    - Exemplu de corp:
      ```json
      {
        "title": "Noua Carte",
        "author": "Autorul Cărții"
      }
      ```
4. **PUT** `/api/books/{id}?publisherId={publisherId}`:
    - Actualizați o carte existentă.
    - Exemplu de corp:
      ```json
      {
        "title": "Titlul Actualizat",
        "author": "Autorul Actualizat"
      }
      ```
5. **DELETE** `/api/books/{id}`: Ștergeți o carte.